<main class="h-screen w-screen portrait:hidden">
  @if (state().isFirstLoad) {
    <app-class-selection></app-class-selection>
  } @else {
    @if (state().status === 'hub') {
      <div class="h-full w-full">
        <app-hub></app-hub>
      </div>
    } @else if (state().status === 'map-selection') {
      <app-map-selection></app-map-selection>
    } @else {
      <!-- This new layout removes the side panels and overlays controls/stats -->
      <div class="h-full w-full relative flex items-center justify-center p-1 sm:p-0">
        
        <!-- The game screen now takes up as much space as possible while remaining square -->
        <div class="relative h-full aspect-square">
          @if (state().status === 'combat') {
            <app-combat-screen></app-combat-screen>
          } @else {
            <app-game-screen></app-game-screen>
          }
        </div>

        <!-- Floor Transition Message -->
        @if (state().floorTransitionMessage; as msg) {
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none">
            <h1 class="text-3xl sm:text-4xl md:text-6xl text-theme-primary text-shadow-pixel animate-floor-transition">
              {{ msg }}
            </h1>
          </div>
        }

        <!-- UI Overlays -->
        @if (state().status !== 'run-summary') {
          <!-- Top Left Panel -->
          <div class="absolute top-1 left-1 sm:top-2 sm:left-2 md:top-4 md:left-4 z-20 w-36 sm:w-48 md:w-60 lg:w-72">
            <app-floor-status></app-floor-status>
          </div>
          
          <!-- Top Right Panel -->
          <div class="absolute top-1 right-1 sm:top-2 sm:right-2 md:top-4 md:right-4 z-20 w-36 sm:w-48 md:w-60 lg:w-72 flex flex-col gap-1 sm:gap-2 md:gap-4">
            <app-player-stats></app-player-stats>
            @if (state().status === 'playing' || state().status === 'combat') {
              <button (click)="toggleInventory()" class="py-1 px-2 text-[10px] sm:text-sm md:py-2 md:px-4 md:text-base btn-pixel btn-pixel-secondary">
                Inventory
              </button>
              <button (click)="toggleSkillBook()" class="py-1 px-2 text-[10px] sm:text-sm md:py-2 md:px-4 md:text-base btn-pixel btn-pixel-secondary" [class.btn-glow-gold]="state().player.skillPoints > 0">
                Skill Book
              </button>
              <button (click)="exitMatch()" class="py-1 px-2 text-[10px] sm:text-sm md:py-2 md:px-4 md:text-base btn-pixel btn-pixel-danger">
                Exit Match
              </button>
            }
          </div>

          @if (state().status === 'playing') {
            <div class="absolute bottom-1 left-1 sm:bottom-2 sm:left-2 md:bottom-4 md:left-4 z-20 w-28 sm:w-36 md:w-44 lg:w-52">
              <app-controls></app-controls>
            </div>
          }
        }
        
      </div>
    }
  }

  @if (state().inventoryPanelOpen) {
    <app-inventory></app-inventory>
  }
  @if (state().shopOpen) {
    <app-shop></app-shop>
  }
  @if (state().appearanceOpen) {
    <app-appearance></app-appearance>
  }
  @if (state().diamondShopOpen) {
    <app-diamond-shop></app-diamond-shop>
  }
  @if (state().characterPanelOpen) {
    <app-character></app-character>
  }
  @if (state().skillBookOpen) {
    <app-skill-book></app-skill-book>
  }
  @if (state().changelogOpen) {
    <app-changelog></app-changelog>
  }
   @if (state().useItemModalOpen) {
    <app-use-item-modal></app-use-item-modal>
  }
  @if (state().fleeConfirmationOpen) {
    <app-flee-confirmation></app-flee-confirmation>
  }
  @if (state().documentationOpen) {
    <app-documentation></app-documentation>
  }
  @if (state().forgeOpen) {
    <app-forge></app-forge>
  }
  @if (state().codexOpen) {
    <app-codex></app-codex>
  }
  @if (state().leaderboardOpen) {
    <app-leaderboard></app-leaderboard>
  }
  @if (state().questBoardOpen) {
    <app-quest-board></app-quest-board>
  }
  @if (state().ascensionPanelOpen) {
    <app-ascension></app-ascension>
  }
  @if (state().gamblingPanelOpen) {
    <app-gambling></app-gambling>
  }
  @if (state().ascensionGridOpen) {
    <app-ascension-grid></app-ascension-grid>
  }
  @if (state().arenaPanelOpen) {
    <app-arena></app-arena>
  }
  @if (state().arenaInfoOpen) {
    <app-arena-info></app-arena-info>
  }
  @if (state().challengeRiftPanelOpen) {
    <app-challenge-rift></app-challenge-rift>
  }
  @if (state().guildPanelOpen) {
    <app-guild></app-guild>
  }
  @if (state().transmutationPanelOpen) {
    <app-transmutation></app-transmutation>
  }
  @if (state().loginRewardPanelOpen) {
    <app-login-reward></app-login-reward>
  }
  @if (state().statsBreakdownOpen) {
    <app-stats-breakdown></app-stats-breakdown>
  }
  @if (state().playerInspectorOpen) {
    <app-player-inspector></app-player-inspector>
  }
  @if (state().altarOpen) {
    <app-altar></app-altar>
  }
  @if (state().synergyBreakOpen) {
    <app-synergy-break></app-synergy-break>
  }
  @if (state().status === 'run-summary') {
    <app-run-summary></app-run-summary>
  }
  @if (state().status === 'arena-combat') {
    <app-arena-combat></app-arena-combat>
  }
  @if (state().exitConfirmationOpen) {
    <app-exit-confirmation></app-exit-confirmation>
  }
  @if (state().newGameConfirmationOpen) {
    <app-new-game-confirmation></app-new-game-confirmation>
  }


  <app-message></app-message>
</main>

<!-- Landscape Mode Enforcement Overlay -->
<div class="hidden portrait:flex fixed inset-0 z-50 bg-gray-900 flex-col items-center justify-center text-center p-4">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-24 h-24 text-gray-600">
    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
  </svg>
  <h2 class="text-2xl text-yellow-400 mt-4">Please Rotate Your Device</h2>
  <p class="text-gray-400 mt-2">This game is designed for landscape mode.</p>
</div>